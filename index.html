<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title></title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-size: 18px;
            font-family: "Helvetica Neue", "Helvetica", "Arial", sans-serif;
            color: #eee;
            background-color: #333;
        }

        main {
            display: inline-block;
            float: left;
            width: 80vw;
            height: 100vh;
            margin-left:20vw;
            background-color: #fff;
            overflow: scroll;
            color: #333;
        }

        nav a {
            color: #eee;
            font-size: 25px;
            text-decoration: none;
            padding-left: 1em;
            display: block;
            transition: all 300ms ease-in-out;
        }

        nav a:visited {
            color: #eee;
        }

        nav a:active {
            color: #f00;
        }

        nav {
            height: 100%;
            width: 0px;
            position: fixed;
            z-index: 1;
            top: 0px;
            padding-bottom:1em;
            left: 0px;
            background-color: #111;
            overflow-x: hidden;
            transition: all 500ms ease-in-out;
            white-space:nowrap;
        }

        nav a:hover {
            color: #f1f1f1;
            background-color:#333;
        }

        nav .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }

        main {
            transition: margin-left .5s;
            padding: 16px;
        }

        @media screen and (max-height: 450px) {
            nav {
                padding-top: 15px;
            }

            nav a {
                font-size: 18px;
            }
        }
        nav {
            width:20vw;
        }
        .closed main {
            width:97vw;
            margin-left:3em;
        }
        .closed nav {
            width:0px;
        }
        #viewer {
            display:inline-block;
            width:78vw;
        }
        .closed #viewer {
            width:94vw;
        }
        #closebtn {
            position:absolute;
            right:8px;
            top:0px;
            font-size:2em;
            z-index:1001;
            cursor:pointer;
        }
        #openbtn {
            position:absolute;
            top:8px;
            left:8px;
            font-size:32px;
            cursor: pointer;
        }
        .selected {
            background-color:#555;
            color:#fff;
        }
    </style>
</head>

<body id="home">
    <nav>
        <a onclick="$('body').classList.add('closed')" id="closebtn">&times;</a>
     </nav>
     <a onclick="$('body').classList.remove('closed')" id='openbtn'>&#9776;</a>
    <main>
        <iframe id='viewer' name='viewer' width='100%' height='100%' src='resumes/timeline.html'></iframe>
    </main>

    <script>
        function $(str) {
            return document.querySelector(str);
        }

        function $$(str) {
            return document.querySelectorAll(str);
        }
        (function() {
            const app = {
                init: function() {
                    $("#closebtn").addEventListener("click", function(e) {
                        console.log("Closing nav");
                        $("body").classList.remove("open");
                        $("body").classList.add("closed");
                    });
                    $("#openbtn").addEventListener("click", function(e) {
                        console.log("Opening nav");
                        $("body").classList.remove("closed");
                        $("body").classList.add("open");
                    });
                    $("nav").addEventListener("click", function(e) {
                        console.dir(e);
                        if (e.target.id!=='closebtn') {
                            $(".selected").classList.remove("selected");
                            e.target.classList.add('selected');
                        }
                    });
                    app.fetchThemes();
                },
                ignoreThemes: ["elite", "apage", "latex", "flat-fr", "kwan-linkedin", "orbit", "srt", "", "mocha-responsive","onepageresume"],
                themes: [],
                fetchThemes: function() {
                    fetch("themes.json").then(response => response.json()).then(function(data) {
                        console.dir(data);
                        let out = '';
                        data.forEach(function(item) {
                            let name = item.replace(/jsonresume\-theme\-/, '');
                            console.log("theme name: " + name);
                            if (!app.ignoreThemes.includes(name)) {
                                console.log("including " + name);
                                app.themes.push({
                                    "name": name,
                                    "fullname": item,
                                    "url": "resumes/" + name + ".html"
                                });
//                                out += "<input type='checkbox' id='" + name + "'> ";
                                let clsname = "";
                                if (name == "timeline") {
                                    clsname = " class='selected'"; 
                                }
                                out += "<a target='viewer'" + clsname + " href='resumes/" + name + ".html' class='themeLink'>" + (name.charAt(0).toUpperCase() + name.slice(1)) + "</a>";
                            } else {
                                console.log("Skipping " + name);
                            }
                        });
                        $("nav").innerHTML += out;
                    });
                },
                picks: [],
                loadResume: function(theme) {
                    console.log("Theme: " + theme);
                    $("#viewer").src = "view.php?theme=" + theme;
                    // $("#viewer").src = "https://registry.jsonresume.org/chrisrobison?theme=" + theme;
                    // fetch("https://registry.jsonresume.org/chrisrobison?theme=" + theme).then(response => response.text()).then(function(page) { $("main").innerHTML = page; });
                }
            }
            window.app = app;
            app.init();
        })();
    </script>
</body>

</html>
