<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title></title>
<style>
    body {
        margin:0;
        padding:0;
        font-size:18px;
        font-family:"Helvetica Neue","Helvetica","Arial",sans-serif;
        color:#eee;
        background-color:#333;
    }
    nav {
        display:inline-block;
        width:13vw;
        float:left;
        height:98vh;
        border-right:3px outset #eee;
        padding:1vh 1vw;
        overflow:scroll;
        background-color:#333;
        line-height:1.8rem;
    }
    main {
        display:inline-block;
        float:left;
        width:84vw;
        height:100vh;
        background-color:#fff;
        overflow:scroll;
        color:#333;
    }
    nav a { 
        color:#eee;
        text-decoration:none;
    }
    nav a:visited {
        color:#ddd;
    }
    nav a:active {
        color:#f00;
    }
</style>
</head>

<body id="home">
    <nav>
    </nav>
    <main>
        <iframe id='viewer' name='viewer' width='100%' height='100%' src='view.php?theme=timeline-fixed'></iframe>
    </main>

<script>
    function $(str) { return document.querySelector(str); }
    function $$(str) { return document.querySelectorAll(str); }
    (function() {
        const app = {
            init: function() {
                app.fetchThemes();
            },
            ignoreThemes: ["elite","apage","kards","latex","classy","dave","even","flat-fr","mocha-responsive","kwan-linkedin","onepageresume","orbit","srt",""],
            themes: [],
            fetchThemes: function() {
                fetch("https://registry.jsonresume.org/themes").then(response => response.json()).then(function(data) {
                    console.dir(data);
                    let out = '';
                    data.forEach(function(item) {
                        let name = item.replace(/jsonresume\-theme\-/, '');
                        if (!app.ignoreThemes.includes(name)) {
                            app.themes.push({"name": name, "fullname": item, "url":"https://registry.jsonresume.org/chrisrobison?theme=" + name });
                            //out += "<input type='checkbox' id='"+name+"'> <a target='viewer' href='https://registry.jsonresume.org/chrisrobison?theme=" + name + "#" + name + "' class='themeLink'>" + (name.charAt(0).toUpperCase() + name.slice(1)) + "</a><br>";
                            out += "<input type='checkbox' id='"+name+"'> ";
                            out += "<a target='viewer' href='view.php?theme=" + name + "#" + name + "' class='themeLink'>" + (name.charAt(0).toUpperCase() + name.slice(1)) + "</a><br>";
                        }
                    });
                    $("nav").innerHTML = out;
                    $$(".themeLink").forEach(function(item) { 
                        item.addEventListener("click", function(e) {
                            if (e.shiftKey) {
                                window.open("view.php?theme=" + e.target.hash.slice(1));
                            } else {
                                app.loadResume(e.target.hash.slice(1));
                            }
                            e.preventDefault();
                            return false;
                        });
                    });
                    $$("input[type=checkbox]").forEach(function(item) {
                        console.dir(item);
                        item.addEventListener("click", function(e) {
                            console.dir(e);
                            if (!app.picks.includes(e.target.id)) {
                                app.picks.push(e.target.id);
                            }
                        });
                    });
                });
            },
            picks: [],
            loadResume: function(theme) {
                console.log("Theme: "+theme);
                $("#viewer").src = "view.php?theme=" + theme;
                // $("#viewer").src = "https://registry.jsonresume.org/chrisrobison?theme=" + theme;
                // fetch("https://registry.jsonresume.org/chrisrobison?theme=" + theme).then(response => response.text()).then(function(page) { $("main").innerHTML = page; });
            }
        }
        window.app = app;
        app.init();
    })();
</script>
</body>
</html>
